(this["webpackJsonp@agoric/wallet-frontend"]=this["webpackJsonp@agoric/wallet-frontend"]||[]).push([[0],{52:function(e,t,n){e.exports=n(63)},63:function(e,t,n){"use strict";n.r(t);var a,r,c=n(0),o=n.n(c),i=n(13),l=n(47),u=n(94),s=n(48),p=n(8),m=n.n(p),f=n(14),g=n(12);function d(){return(d=Object(g.a)(m.a.mark((function e(){var t,n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof ethereum){e.next=3;break}return alert("Please install MetaMask from metamask.io"),e.abrupt("return");case 3:return console.log("logging in to metamask"),t=new URL("package.json","http://localhost:8090").toString(),n="wallet_plugin_".concat(t),e.next=8,ethereum.send({method:"wallet_requestPermissions",params:[Object(f.a)({},n,{})]});case 8:return a=e.sent,e.abrupt("return",a.result&&!a.error);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return h.apply(this,arguments)}function h(){return(h=Object(g.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("requesting index"),"undefined"!==typeof ethereum){e.next=4;break}return alert("Please install MetaMask from metamask.io"),e.abrupt("return");case 4:if(e.prev=4,a){e.next=9;break}return e.next=8,ethereum.requestIndex();case 8:a=e.sent;case 9:if(console.log("now we try to get that plugin API"),r){e.next=15;break}return e.next=13,a.getPluginApi("http://localhost:8090/package.json");case 13:r=e.sent,console.log("oh boyo we did!",r);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),console.error("Problem loading plugin api",e.t0);case 20:return e.abrupt("return",r);case 21:case"end":return e.stop()}}),e,null,[[4,17]])})))).apply(this,arguments)}function b(){return(b=Object(g.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=3;break}return e.next=3,E();case 3:r.walletAcceptOffer(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=Object(g.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=3;break}return e.next=3,E();case 3:r.walletDeclineOffer(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return O.apply(this,arguments)}function O(){return(O=Object(g.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/vat",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){var t=e.ok,n=e.res;return t?n:{}})).catch((function(e){console.log("Fetch Error",e)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=Object(g.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.onConnect,t.onDisconnect,n=t.onMessage,e.next=3,E();case 3:r&&(console.log("registering message handler on pluginApi"),r.onMessage((function(e){console.log("received data from plugin",e),n(e)})).catch((function(e){console.error("issue registering listener",e)})).then((function(){console.log("we really did register that listener. plugin said so.")})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){!function(e){w.apply(this,arguments)}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}var C=function(){return{type:"ACTIVATE_CONNECTION"}},j=function(){return{type:"DEACTIVATE_CONNECTION"}},x=function(){return{type:"SERVER_CONNECTED"}},k=function(){return{type:"SERVER_DISCONNECTED"}},T=function(e){return{type:"UPDATE_PURSES",payload:e}},P=function(e){return{type:"UPDATE_INBOX",payload:e}},R=function(e){return{type:"REJECT_OFFER",payload:e}},A=function(e){return{type:"CONFIRM_OFFER",payload:e}};function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e){return function(){return d.apply(this,arguments)}().then(E).catch((function(e){console.error("Problem installing plugin",e)})),I({},e,{active:!0})}function _(e,t){return function(e){return y.apply(this,arguments)}(t).catch((function(e){console.error("Problem declining offer",e)})),e}function F(e,t){return function(e){return b.apply(this,arguments)}(t).catch((function(e){console.error("Problem accepting offer",e)})),e}var U=function(e,t){var n=t.type,a=t.payload;switch(n){case"ACTIVATE_CONNECTION":return S(e);case"DEACTIVATE_CONNECTION":return function(e){return I({},e,{active:!1})}(e);case"SERVER_CONNECTED":return function(e){return I({},e,{connected:!0})}(e);case"SERVER_DISCONNECTED":return function(e){return I({},e,{connected:!1})}(e);case"UPDATE_PURSES":return function(e,t){return I({},e,{purses:t})}(e,a);case"UPDATE_INBOX":return function(e,t){return I({},e,{inbox:t})}(e,a);case"REJECT_OFFER":return _(e,a);case"CONFIRM_OFFER":return F(e,a);default:throw new TypeError("Action not supported ".concat(n))}},M=Object(c.createContext)();function V(){return Object(c.useContext)(M)}var B=n(37),J=n(93),W=n(83),L=n(84),q=n(30),G=n(39),z=n.n(G),X=Object(B.a)((function(e){return{appBar:{position:"relative"},title:{flexGrow:1},icon:{marginRight:e.spacing(1)}}}));function H(e){var t=e.children,n=X();return o.a.createElement(W.a,{position:"absolute",className:n.appBar},o.a.createElement(L.a,null,o.a.createElement(z.a,{className:n.icon}),o.a.createElement(q.a,{variant:"h6",color:"inherit",noWrap:!0,className:n.title},"Simple Wallet"),t))}var K=n(96),Q=n(85),Y=n(40),Z=n.n(Y),$=Object(B.a)((function(e){return{divider:{marginRight:e.spacing(2)}}}));function ee(){var e=$(),t=V(),n=t.state,a=t.dispatch,r=n.active,c=n.connected,i=n.account;return o.a.createElement(o.a.Fragment,null,c&&o.a.createElement(K.a,{className:e.divider,label:i||"anonymous",avatar:o.a.createElement(Z.a,null)}),r?o.a.createElement(Q.a,{variant:"contained",onClick:function(){a(j())}},"Disconnect"):o.a.createElement(Q.a,{variant:"contained",onClick:function(){a(C())}},"Connect"))}var te=n(66),ne=n(91),ae=n(86),re=n(97),ce=n(87),oe=n(88),ie=n(41),le=n.n(ie),ue=Object(B.a)((function(e){return{icon:{minWidth:24,marginRight:e.spacing(2)}}}));function se(){var e=ue(),t=V().state.purses;return o.a.createElement(o.a.Fragment,null,o.a.createElement(q.a,{variant:"h6"},"Purses"),Array.isArray(t)&&t.length>0?o.a.createElement(ae.a,null,t.map((function(t){var n=t.purseName,a=t.assayId,r=t.allegedName,c=t.extent;return o.a.createElement(re.a,{key:n,value:n,divider:!0},o.a.createElement(ce.a,{className:e.icon},o.a.createElement(le.a,null)),o.a.createElement(oe.a,{primary:n,secondary:"".concat(c," ").concat(a," (").concat(r,")")}))}))):o.a.createElement(q.a,{color:"inherit"},"No purses."))}var pe=n(5),me=n(29),fe=n(90),ge=n(89),de=n(95),Ee=n(92),he=n(42),be=n.n(he),ye=n(45),ve=n.n(ye),Oe=n(46),we=n.n(Oe),Ne=Object(B.a)((function(e){return{icon:{margin:e.spacing(1)},buttons:{"& button ~ button":{marginLeft:e.spacing(1)}}}})),Ce=Object(pe.a)((function(e){return{root:{color:e.palette.getContrastText(me.a[500]),backgroundColor:me.a[500],"&:hover":{backgroundColor:me.a[700]}}}}))(ge.a),je=Object(pe.a)((function(e){return{root:{color:e.palette.getContrastText(fe.a[500]),backgroundColor:fe.a[500],"&:hover":{backgroundColor:fe.a[700]}}}}))(ge.a),xe=Object(pe.a)((function(e){return{root:{width:e.spacing(10),color:me.a[800],borderColor:me.a[800]}}}))(K.a),ke=Object(pe.a)((function(e){return{root:{width:e.spacing(10),color:fe.a[800],borderColor:fe.a[800]}}}))(K.a);function Te(){var e=Ne(),t=V(),n=t.state,a=t.dispatch,r=n.inbox;return o.a.createElement(o.a.Fragment,null,o.a.createElement(q.a,{variant:"h6"},"Transactions"),Array.isArray(r)&&r.length>0?o.a.createElement(ae.a,null,r.map((function(t){var n=t.instanceId,r=t.date,c=t.purseName0,i=t.purseName1,l=t.assayId0,u=t.assayId1,s=t.extent0,p=t.extent1,m=t.status;return o.a.createElement(re.a,{key:r,value:r,divider:!0},o.a.createElement(ce.a,null,o.a.createElement(be.a,{edge:"start",className:e.icon})),o.a.createElement(ne.a,{container:!0,direction:"column"},o.a.createElement(ne.a,{item:!0},o.a.createElement(q.a,{variant:"body2",display:"block"},"".concat(n," - ").concat(function(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}(r)))),o.a.createElement(ne.a,{item:!0},o.a.createElement(q.a,{variant:"body1"},"Pay\xa0",o.a.createElement(de.a,{component:"span",fontWeight:800},s,"\xa0",l,"\xa0"),"from\xa0",c),o.a.createElement(q.a,{variant:"body1"},"to receive\xa0",o.a.createElement(de.a,{component:"span",fontWeight:800},p,"\xa0",u,"\xa0"),"into\xa0",i))),o.a.createElement(Ee.a,{className:e.buttons},"decline"===m&&o.a.createElement(xe,{variant:"outlined",label:"Declined"}),"accept"===m&&o.a.createElement(ke,{variant:"outlined",label:"Accepted"}),!m&&o.a.createElement(o.a.Fragment,null,o.a.createElement(Ce,{size:"small","aria-label":"Decline",onClick:function(){return function(e){a(R(e))}(r)}},o.a.createElement(ve.a,null)),o.a.createElement(je,{size:"small","aria-label":"Accept",onClick:function(){return function(e){a(A(e))}(r)}},o.a.createElement(we.a,null)))))}))):o.a.createElement(q.a,{color:"inherit"},"No transactions."))}var Pe=Object(B.a)((function(e){return{paper:Object(f.a)({marginTop:e.spacing(3),marginBottom:e.spacing(3),padding:e.spacing(2)},e.breakpoints.up(600+2*e.spacing(3)),{marginTop:e.spacing(6),marginBottom:e.spacing(6),padding:e.spacing(3)}),title:{padding:e.spacing(0,0,4)},aside:{borderRightColor:e.palette.divider,borderRightStyle:"solid",borderRightWidth:1}}}));function Re(){var e=Pe();return o.a.createElement(te.a,{className:e.paper},o.a.createElement(q.a,{component:"h1",variant:"h4",align:"center",className:e.title},"Wallet"),o.a.createElement(ne.a,{container:!0,spacing:2},o.a.createElement(ne.a,{item:!0,xs:4,className:e.aside},o.a.createElement(se,null)),o.a.createElement(ne.a,{item:!0,xs:8},o.a.createElement(Te,null))))}var Ae=Object(B.a)((function(e){return{layout:Object(f.a)({width:"auto",marginLeft:e.spacing(2),marginRight:e.spacing(2)},e.breakpoints.up(1e3+2*e.spacing(2)),{width:1e3,marginLeft:"auto",marginRight:"auto"})}}));var De=Object(l.a)({palette:{primary:{main:"#AB2328"},secondary:{main:"#508AA8"}},typography:{useNextVariants:!0}});Object(i.render)(o.a.createElement((function(e){var t=e.children,n=Object(c.useReducer)(U,{active:!1,connected:!1,account:null,purses:null,inbox:null}),a=Object(s.a)(n,2),r=a[0],i=a[1],l=r.active;return Object(c.useEffect)((function(){function e(e){if(e){var t=e.type,n=e.data;"walletUpdatePurses"===t&&(console.log("updating those purses"),i(T(JSON.parse(n)))),"walletUpdateInbox"===t&&(console.log("updating that wlalet"),i(P(JSON.parse(n))))}}N({onConnect:function(){i(x()),v({type:"walletGetPurses"}).then(e),v({type:"walletGetInbox"}).then(e)},onDisconnect:function(){i(k()),i(j()),i(T(null)),i(P(null))},onMessage:function(t){console.log("received data from plugin!",t),e(t)}})}),[l]),o.a.createElement(M.Provider,{value:{state:r,dispatch:i}},t)}),null,o.a.createElement(u.a,{theme:De},o.a.createElement((function(){var e=Ae();return o.a.createElement(o.a.Fragment,null,o.a.createElement(J.a,null),o.a.createElement(H,null,o.a.createElement(ee,null)),o.a.createElement("main",{className:e.layout},o.a.createElement(Re,null)))}),null))),document.getElementById("root"))}},[[52,1,2]]]);
//# sourceMappingURL=main.d495cc4c.chunk.js.map